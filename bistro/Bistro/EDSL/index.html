<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>EDSL (bistro.Bistro.EDSL)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">bistro</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Bistro.EDSL</span></h1></header><div class="doc"><p>This module provides combinators to define new workflows that
execute shell commands.</p></div><div class="spec include"><div class="doc"></div><details open="open"><summary><span class="def"><code><span class="keyword">include </span><span class="keyword">module type of </span><a href="../index.html#module-Template">Template</a><span class="keyword"> with </span><span class="keyword">type </span><a href="../index.html#module-Template">Template</a>.t := <a href="../Template/index.html#type-t">Template.t</a></code></span></summary><p>Represents a text with special symbols</p><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code></code></div><div class="doc"></div></div><div class="spec val" id="val-dest"><a href="#val-dest" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dest : <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Symbol representing the location where a workflow is expected to
produce its result</p></div></div><div class="spec val" id="val-tmp"><a href="#val-tmp" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>tmp : <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Symbol representing an existing empty directory that can be used
as a temporary space for a workflow's execution.</p></div></div><div class="spec val" id="val-np"><a href="#val-np" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>np : <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Symbol representing the number of cores allocated to the
workflow</p></div></div><div class="spec val" id="val-mem"><a href="#val-mem" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>mem : <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Symbol representing the memory size allocated to the workflow,
in GB.</p></div></div><div class="spec val" id="val-exe"><a href="#val-exe" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>exe : <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Symbol representing the path of the current executable, as
specified by <code class="code">Sys.argv.(0)</code></p></div></div><div class="spec val" id="val-string"><a href="#val-string" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>string : string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>A chunk of text</p></div></div><div class="spec val" id="val-int"><a href="#val-int" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>int : int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Int formatting</p></div></div><div class="spec val" id="val-float"><a href="#val-float" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>float : float <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Float formatting</p></div></div><div class="spec val" id="val-path"><a href="#val-path" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>path : <a href="../Path/index.html#type-t">Path.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Path formatting</p></div></div><div class="spec val" id="val-dep"><a href="#val-dep" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dep : <span class="type-var">_</span> <a href="../Workflow/index.html#type-t">Workflow.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">dep w</code> is interpreted as the path where to find the result of
workflow <code class="code">w</code></p></div></div><div class="spec val" id="val-quote"><a href="#val-quote" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>quote : ?&#8288;using:char <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">quote ~using:c t</code> surrounds template <code class="code">t</code> with character <code class="code">c</code></p></div></div><div class="spec val" id="val-option"><a href="#val-option" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>option : (<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> option <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">option f o</code> is <code class="code">f x</code> if <code class="code">o = Some x</code> and <code class="code">string &quot;&quot;</code>
otherwise</p></div></div><div class="spec val" id="val-list"><a href="#val-list" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>list : (<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a>) <span class="keyword">&#8209;&gt;</span> ?&#8288;sep:string <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>list combinator, optional value of <code class="code">sep</code> is <code class="code">&quot;,&quot;</code></p></div></div><div class="spec val" id="val-seq"><a href="#val-seq" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>seq : ?&#8288;sep:string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>another list combinator, default value for <code class="code">sep</code> is <code class="code">&quot;&quot;</code></p></div></div><div class="spec val" id="val-enum"><a href="#val-enum" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>enum : (<span class="type-var">'a</span><span class="keyword"> * </span>string) list <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>combinator for enumerations</p></div></div><div class="spec val" id="val-file_dump"><a href="#val-file_dump" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>file_dump : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">file_dump t</code> can be used when a command needs a configuration
script: at run-time, it will generate a text using <code class="code">t</code>, save it
to a path, deterministically chosen as a function of
<code class="code">t</code>. Finally the template <code class="code">file_dump t</code> is interpreted as this
path.</p></div></div></details></div><div class="spec type" id="type-command"><a href="#type-command" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>command</code><code></code><code></code></div><div class="doc"></div></div><div class="spec val" id="val-workflow"><a href="#val-workflow" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>workflow : ?&#8288;descr:string <span class="keyword">&#8209;&gt;</span> ?&#8288;mem:int <span class="keyword">&#8209;&gt;</span> ?&#8288;np:int <span class="keyword">&#8209;&gt;</span> ?&#8288;version:int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a> list <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="../index.html#type-workflow">workflow</a></code></div><div class="doc"><p>Workflow constructor, taking a list of commands in input. Other arguments are:
</p><ul><li></li></ul><ul class="at-tag"><li><p><span class="at-tag parameter">Parameter</span> <span class="module-path">descr</span>: description of the workflow, used for logging
</p><ul><li></li></ul></li><li><p><span class="at-tag parameter">Parameter</span> <span class="module-path">mem</span>: required memory
</p><ul><li></li></ul></li><li><p><span class="at-tag parameter">Parameter</span> <span class="module-path">np</span>: maximum number of cores (could be given less at execution)
</p><ul><li></li></ul></li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">version</span>: version number, used to force the rebuild of a workflow</li></ul></div></div><div class="spec val" id="val-input"><a href="#val-input" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>input : ?&#8288;may_change:bool <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="../index.html#type-workflow">workflow</a></code></div><div class="doc"><p>Constructs a workflow from an existing file on the
filesystem. The argument <code class="code">may_change</code> indicates that the file
may be modified, which is detected by giving the workflow a
digest of the file as an input.</p></div></div><div class="spec val" id="val-selector"><a href="#val-selector" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>selector : <a href="../Path/index.html#type-t">Path.t</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="../index.html#type-selector">selector</a></code></div><div class="doc"><p>Selector constructor</p></div></div><div class="spec val" id="val-(/)"><a href="#val-(/)" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>(/) : <span class="type-var">_</span> <a href="../index.html#class-type-directory">directory</a> <a href="../index.html#type-workflow">workflow</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="../index.html#type-selector">selector</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> <a href="../index.html#type-workflow">workflow</a></code></div><div class="doc"><p>Constructs a workflow by selecting a dir or file from a
directory workflow</p></div></div><div class="spec val" id="val-cmd"><a href="#val-cmd" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>cmd : string <span class="keyword">&#8209;&gt;</span> ?&#8288;env:<a href="../index.html#type-docker_image">docker_image</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;stdin:<a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;stdout:<a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;stderr:<a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Template/index.html#type-t">Template.t</a> list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a></code></div><div class="doc"><p>Command-line constructor, e.g. <code class="code">cmd &quot;echo&quot; ~stdout:dest [ string
      &quot;foo&quot; ]</code> will generate a shell command like <code class="code">&quot;echo foo &gt;
      /some/path&quot;</code>.
</p><ul><li></li></ul><ul class="at-tag"><li><p><span class="at-tag parameter">Parameter</span> <span class="module-path">env</span>: specifies a Docker image where to run the command
</p><ul><li></li></ul></li><li><p><span class="at-tag parameter">Parameter</span> <span class="module-path">stdin</span>: adds a <code class="code">&quot;&lt; /some/path&quot;</code> token at the end of the command
</p><ul><li></li></ul></li><li><p><span class="at-tag parameter">Parameter</span> <span class="module-path">stdout</span>: adds a <code class="code">&quot;&gt; /some/path&quot;</code> token at the end of the command
</p><ul><li></li></ul></li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">stderr</span>: adds a <code class="code">&quot;2&gt; /some/path&quot;</code> token at the end of the command</li></ul></div></div><div class="spec val" id="val-internal_cmd"><a href="#val-internal_cmd" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>internal_cmd : string <span class="keyword">&#8209;&gt;</span> ?&#8288;stdin:<a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;stdout:<a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;stderr:<a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Template/index.html#type-t">Template.t</a> list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a></code></div><div class="doc"><p>Alternative command-line constructor, calling the current
executable as specified by <code class="code">Sys.argv.(0)</code>. More precisely
<code class="code">internal_cmd subcmd</code> calls <code class="code">Sys.argv.(0)</code> with subcommand
<code class="code">subcmd</code>.</p></div></div><div class="spec val" id="val-opt"><a href="#val-opt" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>opt : string <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <a href="../Template/index.html#type-t">Template.t</a>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <a href="../Template/index.html#type-t">Template.t</a></code></div><div class="doc"><p>Command-line option formatting, e.g.: <code class="code">opt &quot;--output&quot; dep dest</code>
will be rendered like <code class="code">&quot;--output /some/path&quot;</code></p></div></div><div class="spec val" id="val-opt'"><a href="#val-opt'" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>opt' : string <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <a href="../Template/index.html#type-t">Template.t</a>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <a href="../Template/index.html#type-t">Template.t</a></code></div><div class="doc"><p>Same as <a href="index.html#val-opt">opt</a> but renders options with an equal sign,
e.g. <code class="code">&quot;--output=/some/path&quot;</code></p></div></div><div class="spec val" id="val-flag"><a href="#val-flag" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>flag : (<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <a href="../Template/index.html#type-t">Template.t</a>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> bool <span class="keyword">&#8209;&gt;</span> <a href="../Template/index.html#type-t">Template.t</a></code></div><div class="doc"><p><code class="code">flag f x b</code> renders as <code class="code">f x</code> if <code class="code">b</code> is true</p></div></div><div class="spec val" id="val-or_list"><a href="#val-or_list" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>or_list : <a href="index.html#type-command">command</a> list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a></code></div><div class="doc"><p>OR-sequence of commands (<code class="code"> || </code>)</p></div></div><div class="spec val" id="val-and_list"><a href="#val-and_list" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>and_list : <a href="index.html#type-command">command</a> list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a></code></div><div class="doc"><p>AND-sequence of commands (<code class="code"> &amp;&amp; </code>)</p></div></div><div class="spec val" id="val-pipe"><a href="#val-pipe" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pipe : <a href="index.html#type-command">command</a> list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a></code></div><div class="doc"><p>Pipe of commands (<code class="code"> | </code>)</p></div></div><div class="spec val" id="val-(//)"><a href="#val-(//)" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>(//) : <a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <a href="../Template/index.html#type-t">Template.t</a></code></div><div class="doc"><p>Similar to Filename.concat, but with other types.</p></div></div><h6>Useful commands</h6><div class="spec val" id="val-mkdir"><a href="#val-mkdir" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>mkdir : <a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a></code></div><div class="doc"></div></div><div class="spec val" id="val-mkdir_p"><a href="#val-mkdir_p" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>mkdir_p : <a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a></code></div><div class="doc"></div></div><div class="spec val" id="val-wget"><a href="#val-wget" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>wget : ?&#8288;no_check_certificate:bool <span class="keyword">&#8209;&gt;</span> ?&#8288;user:string <span class="keyword">&#8209;&gt;</span> ?&#8288;password:string <span class="keyword">&#8209;&gt;</span> ?&#8288;dest:<a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a></code></div><div class="doc"></div></div><div class="spec val" id="val-cd"><a href="#val-cd" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>cd : <a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a></code></div><div class="doc"></div></div><div class="spec val" id="val-rm_rf"><a href="#val-rm_rf" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>rm_rf : <a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a></code></div><div class="doc"></div></div><div class="spec val" id="val-mv"><a href="#val-mv" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>mv : <a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Template/index.html#type-t">Template.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a></code></div><div class="doc"></div></div><h6>Docker-related</h6><div class="spec val" id="val-docker_image"><a href="#val-docker_image" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>docker_image : ?&#8288;tag:string <span class="keyword">&#8209;&gt;</span> ?&#8288;registry:string <span class="keyword">&#8209;&gt;</span> account:string <span class="keyword">&#8209;&gt;</span> name:string <span class="keyword">&#8209;&gt;</span> unit <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-docker_image">docker_image</a></code></div><div class="doc"><p>Construct a description of a publicly available docker image</p></div></div><div class="spec val" id="val-docker"><a href="#val-docker" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>docker : <a href="../index.html#type-docker_image">docker_image</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a></code></div><div class="doc"><p><code class="code">docker cmd</code> transforms <code class="code">cmd</code> so that it can be executed in a
Docker container.</p></div></div><div class="spec val" id="val-(%)"><a href="#val-(%)" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>(%) : (<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span>) <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'b</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span></code></div><div class="doc"><p>Function composition</p></div></div></body></html>