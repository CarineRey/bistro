<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Bistro (bistro.Bistro)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../index.html">bistro</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Bistro</span></h1></header><p>A library to build scientific workflows.</p><p>This module introduces a type <code class="code">'a worfklow</code> that describe a set of
inter-dependent actions that will eventually generate a target
(file or directory). The <code class="code">'a</code> type represents the format of the
file or the layout of the directory. Actions may be either command
lines to be executed, or OCaml expressions to be evaluated.</p><p>To build workflows, use the <a href="EDSL/index.html">EDSL</a> module, that provide a set of
combinators to write shell scripts easily. For instance, the
following function shows how to create a gzipped file using the
output of another workflow:
</p><pre><code class="code">
      let gzip (x : 'a workflow) : 'a gz workflow =
        workflow ~descr:&quot;unix.gzip&quot; [
          cmd &quot;gzip&quot; [ string &quot;-c&quot; ; dep x ; string &quot;&gt;&quot; dest ]
        ]
    </code></pre><p>Note that a workflow is just a recipe to build some
result. Building the workflow won't actually generate anything. In
order to run the workflow, you have to run it using an execution
engine like the one provided by <code class="code">bistro.engine</code>.</p><div class="spec module" id="module-Path"><a href="#module-Path" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Path/index.html">Path</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Helper functions to represent paths as string lists. For absolute
paths, the first element of the list is <code class="code">&quot;/&quot;</code>.</p></div></div><div class="spec type" id="type-id"><a href="#type-id" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>id</code><code><span class="keyword"> = </span>string</code><code></code></div><div class="doc"></div></div><div class="spec type" id="type-dep"><a href="#type-dep" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>dep</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-dep.Task" class="anchored"><td class="def constructor"><a href="#type-dep.Task" class="anchor"></a><code><span class="keyword">| </span></code><code>`Task<span class="keyword"> of </span><a href="index.html#type-id">id</a></code></td></tr><tr id="type-dep.Select" class="anchored"><td class="def constructor"><a href="#type-dep.Select" class="anchor"></a><code><span class="keyword">| </span></code><code>`Select<span class="keyword"> of </span><a href="index.html#type-id">id</a><span class="keyword"> * </span><a href="Path/index.html#type-t">Path.t</a></code></td></tr><tr id="type-dep.Input" class="anchored"><td class="def constructor"><a href="#type-dep.Input" class="anchor"></a><code><span class="keyword">| </span></code><code>`Input<span class="keyword"> of </span><a href="Path/index.html#type-t">Path.t</a></code></td></tr></table><code> ]</code><code></code></div><div class="doc"></div></div><div class="spec type" id="type-env"><a href="#type-env" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>env</code><code><span class="keyword"> = </span>&lt; dep : <a href="index.html#type-dep">dep</a> <span class="keyword">&#8209;&gt;</span> string; np : int; mem : int; tmp : string; dest : string; &gt;</code><code></code></div><div class="doc"></div></div><div class="spec type" id="type-docker_image"><a href="#type-docker_image" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>docker_image</code><code></code><code><span class="keyword"> = </span><span class="keyword">private </span></code><code>{</code><table class="record"><tr id="type-docker_image.dck_account" class="anchored"><td class="def field"><a href="#type-docker_image.dck_account" class="anchor"></a><code>dck_account : string;</code></td></tr><tr id="type-docker_image.dck_name" class="anchored"><td class="def field"><a href="#type-docker_image.dck_name" class="anchor"></a><code>dck_name : string;</code></td></tr><tr id="type-docker_image.dck_tag" class="anchored"><td class="def field"><a href="#type-docker_image.dck_tag" class="anchor"></a><code>dck_tag : string option;</code></td></tr><tr id="type-docker_image.dck_registry" class="anchored"><td class="def field"><a href="#type-docker_image.dck_registry" class="anchor"></a><code>dck_registry : string option;</code></td></tr></table><code>}</code><code></code></div><div class="doc"><p>Name and version of an external dependency for a workflow</p></div></div><div class="spec module" id="module-Command"><a href="#module-Command" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Command/index.html">Command</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><div class="spec type" id="type-u"><a href="#type-u" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>u</code><code></code><code><span class="keyword"> = </span><span class="keyword">private </span></code><table class="variant"><tr id="type-u.Input" class="anchored"><td class="def constructor"><a href="#type-u.Input" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Input</span><span class="keyword"> of </span>string<span class="keyword"> * </span><a href="Path/index.html#type-t">Path.t</a></code></td></tr><tr id="type-u.Select" class="anchored"><td class="def constructor"><a href="#type-u.Select" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Select</span><span class="keyword"> of </span>string<span class="keyword"> * </span><a href="index.html#type-u">u</a><span class="keyword"> * </span><a href="Path/index.html#type-t">Path.t</a></code></td><td class="doc"><p>(** invariant: <code class="code">u</code> cannot be a <code class="code">Select</code> *)</p></td></tr><tr id="type-u.Step" class="anchored"><td class="def constructor"><a href="#type-u.Step" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Step</span><span class="keyword"> of </span><a href="index.html#type-step">step</a></code></td></tr></table><code></code></div><div class="doc"><p>Workflow untyped representation</p></div></div><div class="spec type" id="type-step"><a href="#type-step" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>step</code><code></code><code><span class="keyword"> = </span><span class="keyword">private </span></code><code>{</code><table class="record"><tr id="type-step.id" class="anchored"><td class="def field"><a href="#type-step.id" class="anchor"></a><code>id : string;</code></td></tr><tr id="type-step.descr" class="anchored"><td class="def field"><a href="#type-step.descr" class="anchor"></a><code>descr : string;</code></td></tr><tr id="type-step.deps" class="anchored"><td class="def field"><a href="#type-step.deps" class="anchor"></a><code>deps : <a href="index.html#type-u">u</a> list;</code></td></tr><tr id="type-step.action" class="anchored"><td class="def field"><a href="#type-step.action" class="anchor"></a><code>action : <a href="index.html#type-action">action</a>;</code></td></tr><tr id="type-step.np" class="anchored"><td class="def field"><a href="#type-step.np" class="anchor"></a><code>np : int;</code></td><td class="doc"><p>(** Required number of processors *)</p></td></tr><tr id="type-step.mem" class="anchored"><td class="def field"><a href="#type-step.mem" class="anchor"></a><code>mem : int;</code></td><td class="doc"><p>(** Required memory in MB *)</p></td></tr><tr id="type-step.version" class="anchored"><td class="def field"><a href="#type-step.version" class="anchor"></a><code>version : int option;</code></td><td class="doc"><p>(** Version number of the wrapper *)</p></td></tr></table><code>}</code><code></code></div><div class="doc"></div></div><div class="spec type" id="type-action"><a href="#type-action" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>action</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-action.Exec" class="anchored"><td class="def constructor"><a href="#type-action.Exec" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Exec</span><span class="keyword"> of </span><a href="index.html#type-dep">dep</a> <a href="Command/index.html#type-t">Command.t</a></code></td></tr><tr id="type-action.Eval" class="anchored"><td class="def constructor"><a href="#type-action.Eval" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Eval</span><span class="keyword"> of </span></code><code>{</code><table class="record"><tr id="type-action.id" class="anchored"><td class="def field"><a href="#type-action.id" class="anchor"></a><code>id : string;</code></td></tr><tr id="type-action.f" class="anchored"><td class="def field"><a href="#type-action.f" class="anchor"></a><code>f : <a href="index.html#type-env">env</a> <span class="keyword">&#8209;&gt;</span> unit;</code></td></tr></table><code>}</code><code></code></td></tr></table><code></code></div><div class="doc"></div></div><div class="spec module" id="module-U"><a href="#module-U" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="U/index.html">U</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><div class="spec type" id="type-selector"><a href="#type-selector" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>(+'a, +'b) selector</code><code></code><code><span class="keyword"> = </span><span class="keyword">private </span></code><table class="variant"><tr id="type-selector.Selector" class="anchored"><td class="def constructor"><a href="#type-selector.Selector" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Selector</span><span class="keyword"> of </span><a href="Path/index.html#type-t">Path.t</a></code></td></tr></table><code></code></div><div class="doc"><p>Describes the (relative) path from a <code class="code">'a directory workflow</code>
target to some <code class="code">'b workflow</code> target. This is useful to construct
new workflows by selecting a file or a subdirectory in the result
of a directory workflow.</p></div></div><div class="spec module" id="module-Workflow"><a href="#module-Workflow" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Workflow/index.html">Workflow</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>The type representing a set of actions (shell scripts or
evaluations of OCaml expressions) to build a target of type
<code class="code">'a</code>. The type <code class="code">'a</code> is a phantom type, which can be used to
enforce static invariants.</p></div></div><div class="spec module" id="module-Template"><a href="#module-Template" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Template/index.html">Template</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Represents a text with special symbols</p></div></div><div class="spec type" id="type-workflow"><a href="#type-workflow" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>'a workflow</code><code><span class="keyword"> = </span><span class="type-var">'a</span> <a href="Workflow/index.html#type-t">Workflow.t</a></code><code></code></div><div class="doc"></div></div><div class="spec type" id="type-any_workflow"><a href="#type-any_workflow" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>any_workflow</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-any_workflow.Any_workflow" class="anchored"><td class="def constructor"><a href="#type-any_workflow.Any_workflow" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Any_workflow</span><span class="keyword"> : </span><span class="type-var">_</span> <a href="Workflow/index.html#type-t">Workflow.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-any_workflow">any_workflow</a></code></td></tr></table><code></code></div><div class="doc"></div></div><div class="spec class-type" id="class-type-directory"><a href="#class-type-directory" class="anchor"></a><div class="def class-type"><code><span class="keyword">class type </span>'a <a href="class-directory/index.html">directory</a> = <span class="keyword">object</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Conventional type to represent directory targets</p></div></div><div class="spec module" id="module-EDSL"><a href="#module-EDSL" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="EDSL/index.html">EDSL</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>This module provides combinators to define new workflows that
execute shell commands.</p></div></div><div class="spec module" id="module-Std"><a href="#module-Std" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Std/index.html">Std</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Standard definitions</p></div></div></body></html>